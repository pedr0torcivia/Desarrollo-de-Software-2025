<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estaciones - BiciAlquileres</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/bicialquileres.css">
</head>
<body>
    <header class="text-white">
        <div class="container py-5 h-100 position-relative">
            <div class="usuario-pill">
                <i class="bi bi-person-circle"></i>
                <span>Nombre Apellido</span>
            </div>
            <nav class="mt-3">
                <ul class="nav nav-pills nav-fill gap-2 p-1 small bg-primary rounded-5 shadow-sm justify-content-center" id="pillNav">
                    <li class="nav-item"><a class="nav-link rounded-5" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link rounded-5" href="alquileres.html">Alquileres</a></li>
                    <li class="nav-item"><a class="nav-link active rounded-5" href="estaciones.html">Estaciones</a></li>
                    <li class="nav-item"><a class="nav-link rounded-5" href="datos.html">Mis Datos</a></li>
                    <li class="nav-item"><a class="nav-link rounded-5" href="contacto.html">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container my-5">
        <h1 class="mb-4">Lista de Estaciones</h1>

        <form class="row g-3 mb-4" id="filtroFormulario">
            <div class="col-md-4">
                <label for="texto" class="form-label">Texto:</label>
                <input type="text" class="form-control" id="texto" name="texto" placeholder="Texto a filtrar">
            </div>
            <div class="col-md-4">
                <label for="barrio" class="form-label">Barrio:</label>
                <select class="form-select" name="barrio" id="barrio">
                    <option value="Todos" selected>Todos</option>
                    <option value="Centro">Centro</option>
                    <option value="Nueva Córdoba">Nueva Córdoba</option>
                    <option value="Ciudad Universitaria">Ciudad Universitaria</option>
                    <option value="General Paz">General Paz</option>
                    <option value="Alberdi">Alberdi</option>
                    <option value="Jardín">Jardín</option>
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" name="inactivos" id="inactivos">
                    <label class="form-check-label" for="inactivos">Incluir Inactivos</label>
                </div>
            </div>
            <div class="col-md-2 d-flex align-items-end justify-content-end">
                <button type="submit" class="btn btn-primary w-100" id="filtrarBtn">Filtrar</button>
            </div>
        </form>

        <table class="table table-bordered table-striped">
            <thead class="table-primary">
                <tr>
                    <th>Nro</th>
                    <th>Nombre</th>
                    <th>Dirección</th>
                    <th>Barrio</th>
                    <th>Activo</th>
                </tr>
            </thead>
            <tbody id="tablaEstaciones">
                <!-- Filas de las estaciones se agregarán aquí dinámicamente -->
            </tbody>
        </table>
    </main>

    <footer class="bg-info text-white text-center py-2">
        <p class="mb-0">Sitio educativo de práctica - DDS 3K2</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/bicialquileres.js"></script>
    <script>
        document.getElementById("filtroFormulario").addEventListener("submit", async (e) => {
            e.preventDefault(); // Evitar que se recargue la página
    
            // Obtener los valores de los filtros
            const texto = document.getElementById("texto").value;
            const barrio = document.getElementById("barrio").value;
            const incluirInactivos = document.getElementById("inactivos").checked;
    
            // Construir la URL con los parámetros de los filtros
            const url = new URL("/api/estaciones", window.location.origin);
            if (texto) url.searchParams.append("texto", texto);
            if (barrio && barrio !== "Todos") url.searchParams.append("barrio", barrio);
            url.searchParams.append("incluirInactivos", incluirInactivos ? "true" : "false");
    
            // Mostrar mensaje de carga
            const tabla = document.getElementById("tablaEstaciones");
            tabla.innerHTML = "<tr><td colspan='5' class='text-center'>Cargando...</td></tr>";
    
            try {
                // Realizar la solicitud fetch para obtener las estaciones
                const response = await fetch(url);
    
                if (!response.ok) {
                    throw new Error("No se pudieron obtener las estaciones");
                }
    
                const estaciones = await response.json();
    
                // Limpiar tabla y mostrar estaciones
                tabla.innerHTML = ""; // Limpiar la tabla
    
                if (estaciones.length === 0) {
                    tabla.innerHTML = "<tr><td colspan='5' class='text-center'>No se encontraron estaciones</td></tr>";
                    return;
                }
    
                estaciones.forEach(estacion => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${estacion.idEstacion}</td>
                        <td>${estacion.nombre}</td>
                        <td>${estacion.direccion}</td>
                        <td>${estacion.barrio}</td>
                        <td>${estacion.activa ? "Sí" : "No"}</td>
                    `;
                    tabla.appendChild(row);
                });
            } catch (error) {
                console.error("Error:", error);
                tabla.innerHTML = "<tr><td colspan='5' class='text-center'>Hubo un error al cargar las estaciones</td></tr>";
            }
        });
    </script>    
</body>
</html>
